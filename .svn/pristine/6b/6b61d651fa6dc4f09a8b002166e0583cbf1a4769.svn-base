package com.hd.common.util;

import java.io.File;
import java.io.IOException;
import java.util.Date;
import java.util.Iterator;
import java.util.List;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.fileupload.DiskFileUpload;
import org.apache.commons.fileupload.FileItem;



public class LoginFilter implements Filter {

	@Override
	public void destroy() {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void doFilter(ServletRequest request, ServletResponse response,
			FilterChain fc) throws IOException, ServletException {
		
		

                      
		
		HttpServletRequest req = (HttpServletRequest) request;    
	    HttpServletResponse res = (HttpServletResponse) response;    
	    HttpSession session = req.getSession(); //获取session 
	 
	    String str = req.getRequestURI();
		
		String[] temp = str.split("\\?");
		
		String uri = temp[0];
		//接口请求不拦截
		if (uri.contains("/rest/")||uri.contains("addAgree")
				||uri.contains("addCollection")
				||uri.contains("restpassword")
				||uri.contains("collectionList")
				||uri.contains("uploadheadimg")
				||uri.contains("archive")
				||uri.contains("userUpdate")
				||uri.contains("js")
				||uri.contains("app")
				||uri.contains("css")
				||uri.contains("addComments")) {
			fc.doFilter(request, response);
			return;
		}
		if (uri.endsWith("addMessages")) {
//			UserModel user = (UserModel)session.getAttribute("UuserModel");
//			List<String> namelist= ImageUploadUtil.uploadimg(req,user.getUser_id());
//			req.setAttribute("picnames", namelist);
			
		}
		if (uri.endsWith("uploadheadimg")) {
//			UserModel user = (UserModel)session.getAttribute("UuserModel");
//			List<String> namelist= ImageUploadUtil.uploadimg(req,user.getUser_id());
//			req.setAttribute("picnames", namelist);
			
		}
		
		if(uri.endsWith("login")||uri.endsWith("loginValidator") ||uri.endsWith("addMessages") ||uri.endsWith("register") ||uri.endsWith("updatepassword")
			|| uri.endsWith("messageShare")	|| uri.endsWith("mbmsgmessagedetil") || uri.endsWith(".png") || uri.endsWith(".gif")|| uri.endsWith(".jpg") || uri.endsWith("feedback") ){
			
			fc.doFilter(request, response);
		}else{
//			UserModel user = (UserModel)session.getAttribute("UuserModel");
//			
//			if(session.getAttribute("UuserModel")!=null){
//				
//				fc.doFilter(request, response);
//			}else{
//				res.sendRedirect( "login" );
//				return;
//			}
		}
	    
	    
		
	}

	@Override
	public void init(FilterConfig arg0) throws ServletException {
		// TODO Auto-generated method stub
		
	}

}
